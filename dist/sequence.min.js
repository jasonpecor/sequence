var Sequence=function(t){"use strict";function e(t,e){return e=e||[],Array.prototype.unshift.call(e,t),e}function n(t){return Array.prototype.splice.call(t,1)}function r(e,n){this.id=n||null,this._abort=t,this.steps=[];for(var s=e.length,i=0;s>i;i++)if(e[i]instanceof r)for(var o=0,u=e[i].steps.length;u>o;o++)this.steps.push(e[i].steps[o]);else this.steps.push(e[i])}function s(e){this.sequence=e,this._abort=t,this.pos=0}function i(t,e){return new s(t instanceof r?t:new r(t,e))}return s.prototype.abort=function(t){if(this._abort)throw"Sequence abort already requested";return this._abort=t||!0,this},s.prototype.run=function(r,s,i){function o(){if(p._abort)return"function"==typeof p._abort&&p._abort.apply(u,arguments),void(p._abort=t);if(arguments[0]===!1){if(!s)throw"Sequence failed silently";s.apply(u,n(arguments))}else if(p.pos<a){var i=p.sequence.steps[p.pos++];i.apply(u,e(o,arguments))}else r&&r.apply(u,arguments)}i=i||{};var u=i.context||null,a=this.sequence.steps.length,p=this;return o.apply(u,i.params||[]),this},s.prototype.repeat=function(t,e,n,r){function s(){o.reset().run(function(){t>i?(i++,s()):e&&e.apply(u,arguments)},function(){if(!n)throw"Repeating sequencer failed silently";n.apply(u,arguments)},r)}r=r||{};var i=0,o=this,u=r.context||null;return s(),this},s.prototype.reset=function(){return this.pos=0,this._abort=t,this},i.create=function(t,e){return new r(t,e)},i}();